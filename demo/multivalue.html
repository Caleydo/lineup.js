<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>LineUp alpha</title>

  <link href="../node_modules/font-awesome/css/font-awesome.css" rel="stylesheet" type='text/css'>
  <link href="../../node_modules/font-awesome/css/font-awesome.css" rel="stylesheet" type='text/css'>

  <link href="../build/style.css" rel="stylesheet">

  <style>
    .lu {
      clear: both;
      position: absolute;
      top: 1px;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0;
    }

  </style>
</head>
<body>
<script src="../node_modules/d3/d3.js"></script>
<script src="../../node_modules/d3/d3.js"></script>
<script src="../build/LineUpJS.js"></script>
<script>

window.onload = function () {
  d3.json('./multivalue.json', (data) => {

    const years = [2012, 2013, 2014, 2015];
    const groups = ['pi_score', 'eco_score', 'eo_score', 'health_score', 'ss_score', 'pf_score', 'sk_score'];

    data.forEach((row) => {
      groups.forEach((group) => {
        row[group] = years.map((year) => row[group + year]);
      });
    });

    const desc = [
      {label: 'Country', type: 'string', column: 'country'},
      {label: 'ISO', type: 'string', column: 'iso'},
      {label: 'Region', type: 'categorical', column: 'region', categories: Array.from(new Set(data.map((d) => d.region)))},
      {label: 'PI Region', type: 'categorical', column: 'piregion', categories: Array.from(new Set(data.map((d) => d.piregion)))},
    ].concat(...groups.map((group, i) => {
      return  ['boxplot', 'threshold', 'sparkline', 'numbers', 'verticalbar'].map((rendererType) => ({
        label: group,
        type: 'numbers',
        dataLength: years.length,
        rendererType,
        column: group,
        domain: d3.extent([].concat(...data.map((d) => d[group])))
      }));
    }));

    //artificial booleans column
    desc.push({
      label: groups[0] + ' >= 0',
      type: 'booleans',
      column: groups[0],
      dataLength: years.length,
      accessor: (row) => row[groups[0]].map((d) => d >= 0)
    });

    const p = LineUpJS.createLocalStorage(data, desc);
    p.deriveDefault();

    const lineup = LineUpJS.create(p, document.body, {
      body: {
        renderer: 'engine',
      },
    });
    lineup.update();
  })
};

</script>

</body>
</html>
