/*! LineUpJS - v0.1.0 - 2014-10-17
* https://github.com/Caleydo/lineup.js
* Copyright (c) 2014 ; Licensed BSD */
(function(){function a(a,b,c){var d;!function(a,b,c,d){function e(b,d,e){this.storage=b.storage,this.spec=b,this.$container=d,this.$table=d.append("svg").attr("class","lu"),this.tooltip=a.createTooltip(d.node()),this.config=c.extend(!0,{},a.defaultConfig,e,{columnBundles:{primary:{sortedColumn:null,sortingOrderAsc:!0},secondary:{sortedColumn:[],sortingOrderAsc:!0}}}),this.storage.config=this.config;var f=this.$table.append("defs");f.append("defs").attr("class","columnheader"),f.append("defs").attr("class","column"),f.append("defs").attr("class","overlay"),this.$body=this.$table.append("g").attr("transform","translate(0,"+this.config.htmlLayout.headerHeight+")"),this.$header=this.$table.append("g").attr("class","header"),this.$header.append("rect").attr({width:"100%",height:this.config.htmlLayout.headerHeight,fill:"lightgray"}),this.$header.append("g").attr("class","main"),this.$header.append("g").attr("class","overlay"),this.headerUpdateRequired=!0,this.stackedColumnModified=null;var g=this.initScrolling(c(d.node()));return this.selectVisible=g.selectVisible,this.onScroll=g.onScroll,this.dragWeight=this.initDragging(),this}a.prototype=e.prototype=c.extend(e.prototype,a.prototype),a.create=function(a,b,d){c.isPlainObject(a)||(a={storage:a});var f=new e(a,b,d);return f.startVis(),f},a.prototype.scrolled=function(a){this.$header.attr("transform","translate(0,"+a+")")},a.defaultConfig={colorMapping:b.map(),columnColors:b.scale.category20(),grayColor:"#999999",numberformat:b.format(".3n"),htmlLayout:{headerHeight:50},renderingOptions:{stacked:!1,values:!1,animation:!0},svgLayout:{rowHeight:20,backupScrollRows:4,animationDuration:1e3,plusSigns:{},rowActions:[]},manipulative:!0,filter:{skip:0,limit:Number.POSITIVE_INFINITY,filter:d}},a.prototype.changeDataStorage=function(a){this.storage=a.storage,this.storage.config=this.config,this.spec=a,this.config.columnBundles.primary.sortedColumn=null,this.headerUpdateRequired=!0,delete this.prevRowScale},a.prototype.startVis=function(){this.assignColors(this.storage.getRawColumns()),this.headerUpdateRequired=!0,this.storage.resortData({}),this.updateAll()},a.prototype.updateAll=function(a){this.updateHeader(this.storage.getColumnLayout()),this.updateBody(this.storage.getColumnLayout(),this.storage.getData(),a||!1)},a.prototype.sortBy=function(a,b){a=a||this.storage.primaryKey,b=b||!1;var c=this.storage.getColumnByName(a);if(!c)return!1;var d=this.config.columnBundles[c.columnBundle];d.sortingOrderAsc=b,d.sortedColumn=c,this.storage.resortData({column:c,asc:d.sortingOrderAsc}),this.updateAll()},a.prototype.toggleStackedRendering=function(){this.config.renderingOptions.stacked=!this.config.renderingOptions.stacked,this.updateAll(!0)},a.prototype.toggleValueRendering=function(){this.config.renderingOptions.values=!this.config.renderingOptions.values,this.updateAll(!0)},a.prototype.setLimits=function(a,b){this.config.filter.skip=a,this.config.filter.limit=b,this.storage.resortData({}),this.updateAll()},a.prototype.changeWeights=function(b,c){return"string"==typeof b&&(b=this.storage.getColumnByName(b)),b=b||this.config.columnBundles.primary.sortedColumn,b instanceof a.LayoutStackedColumn?(b.updateWeights(c),b===this.config.columnBundles.primary.sortedColumn&&this.storage.resortData({}),this.updateAll(),!0):!1},a.prototype.destroy=function(){this.$header.selectAll("*").remove(),this.$body.selectAll("*").remove(),this.tooltip.destroy(),this.$container.off("scroll",this.onScroll)}}(d||(d={}),b,a);var d;!function(a,b,c,d){function e(a){this.column=a.column,this.label=a.label||a.column,this.id=a.id||this.column,this.missingValue=a.missingValue,this.layout={}}function f(a){e.call(this,a),this.scale=b.scale.linear().clamp(!0).domain(a.domain||[0,100]).range(a.range||[0,1]),this.scaleOri=this.scale.copy(),"undefined"==typeof this.missingValue&&(this.missingValue=0/0)}function g(a){e.call(this,a)}function h(a,c){e.call(this,a),this.label=a.label||"Rank",this.values=b.map(),this.storage=c}function i(a){var c=this;this.columnWidth=a.width||100,this.id=d.uniqueId("Column_"),this.scale=b.scale.linear().domain([0,1]).range([0,c.columnWidth]),this.filter=a.filter,this.parent=a.parent,this.columnBundle=a.columnBundle||"primary",this.sortBy=function(a,b){return a=c.column.getValue(a),b=c.column.getValue(b),c.safeSortBy(a,b)}}function j(a,b){i.call(this,a),this.columnLink=a.column;var c=this;this.column=""===a.column?null:b.filter(function(a){return a.id===c.columnLink})[0],this.id=d.uniqueId(this.columnLink+"_"),this.column&&this.init()}function k(a,b,c,e){i.call(this,a?a:{},[]),this.columnLink="rank",this.columnWidth=a?a.width||50:50,this.column=new h({column:"rank"},e),this.id=d.uniqueId(this.columnLink+"_")}function l(a,b){i.call(this,a,b),this.childrenLinks=a.children||[],this.label=a.label||this.id}function m(a,b,c){l.call(this,a,b),this.childrenWeights=[],this.childrenWidths=[],this.toLayoutColumn=c,this.children=[],this.emptyColumns=[],this.init(a);var d=this;this.sortBy=function(a,b){var c=0,e=0;return d.children.forEach(function(d){c+=d.getWidth(a),e+=d.getWidth(b)}),d.safeSortBy(c,e)}}function n(a){i.call(this,a,[]),this.columnLink="empty",this.column={getValue:function(){return""},getRawValue:function(){return""}},this.id=d.uniqueId(this.columnLink+"_"),this.label="{empty}",this.columnWidth=50}function o(a){a=a||{},i.call(this,a,[]),this.columnLink="action",this.column={getValue:function(){return""},getRawValue:function(){return""}},this.id=d.uniqueId(this.columnLink+"_a"),this.label="",this.columnWidth=a.width||50}a.LineUpColumn=e,e.prototype=c.extend({},{},{getValue:function(a){var b=a[this.column];return"undefined"==typeof b?this.missingValue:b},getRawValue:function(a){var b=this.getValue(a);return"undefined"==typeof b?"":b},filter:function(){return!0}}),a.LineUpNumberColumn=f,f.prototype=c.extend({},e.prototype,{getValue:function(a){var b=e.prototype.getValue.call(this,a);return(""===b||0===b.toString().trim().length)&&(b=this.missingValue),this.scale(+b)},getRawValue:function(a){var b=e.prototype.getValue.call(this,a);return isNaN(b)?"":b},filter:function(a,b){var c=this.getValue(a);return isNaN(b)?!isNaN(c):"number"==typeof b?c>=b:Array.isArray(b)?b[0]<=c&&c<=b[1]:void 0}}),a.LineUpStringColumn=g,g.prototype=c.extend({},e.prototype,{filter:function(a,b){var c=this.getValue(a);return"boolean"==typeof c?c&&c.trim().length>0:"string"==typeof b&&b.length>0?c&&c.toLowerCase().indexOf(b.toLowerCase())>=0:b instanceof RegExp?c&&c.match(b):!0}}),a.LineUpRankColumn=h,h.prototype=c.extend({},e.prototype,{setValue:function(a,b){this.values.set(a[this.storage.primaryKey],b)},getValue:function(a){return this.values.get(a[this.storage.primaryKey])},filter:function(a,b){var c=this.getValue(a);return"undefined"==typeof c?!0:"number"==typeof b?c>=b:Array.isArray(b)?b[0]<=c&&c<=b[1]:void 0}}),a.LayoutColumn=i,i.prototype=c.extend({},{},{setColumnWidth:function(a,b){this.columnWidth=a,this.scale.range([0,a]),!b&&this.parent&&this.parent.updateWidthFromChild({id:this.id,newWidth:a})},getColumnWidth:function(){return this.columnWidth},safeSortBy:function(a,c){var d="number"==typeof a&&isNaN(a),e="number"==typeof c&&isNaN(c);return d&&e?0:d?1:e?-1:b.descending(a,c)},flattenMe:function(a){a.push(this)},description:function(){var a={};return a.width=this.columnWidth,a.columnBundle=this.columnBundle,a.filter=this.filter,a},makeCopy:function(){return new i(this.description())},isFiltered:function(){return"undefined"!=typeof this.filter},filterBy:function(){return!0}}),a.LayoutSingleColumn=j,j.prototype=c.extend({},i.prototype,{init:function(){},getWidth:function(a){var b=this.column.getValue(a);return isNaN(b)||"undefined"==typeof b?0:this.scale(b)},filterBy:function(a){return"undefined"!=typeof this.filter&&this.column?this.column.filter(a,this.filter):!0},getLabel:function(){return this.column.label},getDataID:function(){return this.column.id},description:function(){var a=i.prototype.description.call(this);return a.column=this.columnLink,a},makeCopy:function(){var a=this.description();a.column="";var b=new j(a);return b.columnLink=this.columnLink.slice(0),b.column=this.column,b.id=d.uniqueId(this.columnLink+"_"),b.init(),b}}),a.LayoutRankColumn=k,k.prototype=c.extend({},i.prototype,{getLabel:function(){return this.column.label},getDataID:function(){return this.column.id},description:function(){var a=i.prototype.description.call(this);return a.type="rank",a},makeCopy:function(){var a=this.description(),b=new k(a,null,null,this.column.storage);return b}}),a.LayoutCompositeColumn=l,l.prototype=c.extend({},i.prototype,{getDataID:function(){return this.id},getLabel:function(){return this.label}}),a.LayoutStackedColumn=m,m.prototype=c.extend({},l.prototype,{getValue:function(a){var b=this,c=0;return this.children.forEach(function(d,e){var f=d.column.getValue(a);(isNaN(f)||"undefined"==typeof f)&&(f=0),c+=f*b.childrenWeights[e]}),c},init:function(a){var c=this;this.childrenLinks.length<1?this.emptyColumns.push(new n({parent:c})):(this.childrenLinks[0].hasOwnProperty("weight")?(this.childrenWeights=this.childrenLinks.map(function(a){return+(a.weight||1)}),this.scale.domain([0,b.sum(this.childrenWeights)]),a.hasOwnProperty("width")?this.childrenWidths=this.childrenWeights.map(function(a){return c.scale(a)}):(this.columnWidth=100*this.children.length,this.scale.range([0,c.columnWidth]))):(this.childrenWidths=this.childrenLinks.map(function(a){return+(a.width||100)}),this.childrenWeights=this.childrenWidths.map(function(a){return a/100}),this.columnWidth=b.sum(this.childrenWidths),this.scale.domain([0,b.sum(this.childrenWeights)]).range([0,this.columnWidth])),this.children=this.childrenLinks.map(function(a,b){return c.toLayoutColumn({column:a.column,width:c.childrenWidths[b],parent:c})}))},flattenMe:function(a,b){var c=!1;b&&(c=b.addEmptyColumns||!1),a.push(this),this.children.forEach(function(b){b.flattenMe(a)}),c&&this.emptyColumns.forEach(function(b){return b.flattenMe(a)})},filterBy:function(a){if("undefined"==typeof this.filter)return!0;var b=this.getValue(a);return"number"==typeof this.filter?b<=this.filter:Array.isArray(this.filter)?this.filter[0]<=b&&b<=this.filter[1]:!0},updateWidthFromChild:function(){var a=this;this.childrenWidths=this.children.map(function(a){return a.getColumnWidth()}),this.childrenWeights=this.childrenWidths.map(function(b){return a.scale.invert(b)}),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)])},setColumnWidth:function(a){var b=this;this.columnWidth=a,b.scale.range([0,this.columnWidth]),this.childrenWidths=this.childrenWeights.map(function(a){return b.scale(a)}),this.children.forEach(function(a,c){return a.setColumnWidth(b.childrenWidths[c],!0)})},updateWeights:function(a){this.childrenWeights=a,this.scale.domain([0,b.sum(this.childrenWeights)]);var c=this;this.childrenWidths=this.childrenWeights.map(function(a){return c.scale(a)}),this.columnWidth=b.sum(this.childrenWidths),this.children.forEach(function(a,b){return a.setColumnWidth(c.childrenWidths[b],!0)})},removeChild:function(c){var d=this.children.indexOf(c),e=this;this.childrenWeights.splice(d,1),this.childrenWidths.splice(d,1),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)]),this.children.splice(d,1),c.parent=null,this.children.length<1&&(this.emptyColumns=[new a.LayoutEmptyColumn({parent:e})],this.columnWidth=100)},addChild:function(c,d,e){if(!(c instanceof a.LayoutSingleColumn&&c.column instanceof a.LineUpNumberColumn))return!1;var f=0;return d instanceof a.LayoutEmptyColumn?this.emptyColumns=[]:(f=this.children.indexOf(d),"r"===e&&f++),this.childrenWeights.splice(f,0,this.scale.invert(c.getColumnWidth())),this.childrenWidths.splice(f,0,c.getColumnWidth()),this.columnWidth=b.sum(this.childrenWidths),this.scale.range([0,this.columnWidth]),this.scale.domain([0,b.sum(this.childrenWeights)]),c.parent=this,this.children.splice(f,0,c),!0},description:function(){var a=i.prototype.description.call(this);a.type="stacked";var b=this;return a.children=this.children.map(function(a,c){return{column:a.columnLink,weight:b.childrenWeights[c]}}),a.label=this.label,a},makeCopy:function(){var a=this,c=a.description();c.childrenLinks=[];var d=new m(c,{},a.toLayoutColumn);return d.children=a.children.map(function(a){return a.makeCopy()}),d.children.forEach(function(a){a.parent=d}),d.childrenWeights=this.childrenWeights.slice(0),d.scale.domain([0,b.sum(this.childrenWeights)]),d.childrenWidths=this.childrenWeights.map(function(b){return a.scale(b)}),d}}),a.LayoutEmptyColumn=n,n.prototype=c.extend({},i.prototype,{getLabel:function(){return this.label},getDataID:function(){return this.id}}),a.LayoutActionColumn=o,o.prototype=c.extend({},i.prototype,{getLabel:function(){return this.label},getDataID:function(){return this.id},description:function(){var a=i.prototype.description.call(this);return a.type="actions",a}})}(d||(d={}),b,a,c);var d;!function(a,b,c,d){function e(a,d,e){e=c.extend({},e,{x:+window.innerWidth/2-100,y:100,width:400,height:200});var f=b.select("body").append("div").attr("class","lu-popupBG"),g=b.select("body").append("div").attr({"class":"lu-popup"}).style({left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"200px"}).html('<span style="font-weight: bold">'+a+"</span>"+(d?'<input type="text" id="popupInputText" size="35" value="'+d+'"><br>':"")+'<div class="selectionTable"></div><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="ok"><i class="fa fa-check"></i> ok</button>'),h=g.select(".selectionTable").style({width:e.width-10+"px",height:e.height-40+"px"}).append("table");return g.select(".cancel").on("click",function(){f.remove(),g.remove()}),{popup:g,table:h,remove:function(){g.remove(),f.remove()},onOK:function(a){return g.select(".ok").on("click",a)}}}a.prototype=a.prototype||{},a.prototype.addNewStackedColumnDialog=function(){function b(){var a=d.table.selectAll("tr").data(f);a.select(".checkmark").html(function(a){return a.isChecked?'<i class="fa fa-check-square-o"></i>':'<i class="fa fa-square-o"></i>'}).on("click",function(a){a.isChecked=!a.isChecked,b()}),a.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"}),a.select(".weightInput").attr("disabled",function(a){return a.isChecked?null:!0})}var c=this,d=e("add stacked column:","Stacked"),f=c.storage.getRawColumns().filter(function(b){return b instanceof a.LineUpNumberColumn}).map(function(a){return{d:a,isChecked:!1,weight:1}}),g=d.table.selectAll("tr").data(f);g.enter().append("tr"),g.append("td").attr("class","checkmark"),g.append("td").attr("class","datalabel").style("opacity",.8).text(function(a){return a.d.label}),g.append("td").append("input").attr({"class":"weightInput",type:"text",value:function(a){return a.weight},disabled:!0,size:5}).on("input",function(a){a.weight=+this.value,b()}),b(),d.onOK(function(){var a=document.getElementById("popupInputText").value;if(a.length<1)return void window.alert("name must not be empty");var b=f.filter(function(a){return a.isChecked}),e={label:a,width:Math.max(100*b.length,100),children:b.map(function(a){return{column:a.d.id,weight:a.weight}})};c.storage.addStackedColumn(e),d.remove(),c.headerUpdateRequired=!0,c.updateAll()})},a.prototype.addNewSingleColumnDialog=function(){function a(){var b=c.table.selectAll("tr").data(f);b.select(".checkmark").html(function(a){return'<i class="fa fa-'+(a.isChecked?"check-":"")+'square-o"></i>'}).on("click",function(b){b.isChecked=!b.isChecked,a()}),b.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"})}var b=this,c=e("add single columns",d),f=b.storage.getRawColumns().map(function(a){return{d:a,isChecked:!1,weight:1}}),g=c.table.selectAll("tr").data(f);g.enter().append("tr"),g.append("td").attr("class","checkmark"),g.append("td").attr("class","datalabel").style("opacity",.8).text(function(a){return a.d.label}),a(),c.onOK(function(){var a=f.filter(function(a){return a.isChecked});a.forEach(function(a){b.storage.addSingleColumn({column:a.d.id})}),c.remove(),b.headerUpdateRequired=!0,b.updateAll()})},a.prototype.reweightStackedColumnWidget=function(a,c){function d(){var d=c.selectAll("tr").data(a);f.domain([0,b.max(a,e)]),d.select(".predictBar").transition().style({width:function(a){return f(a.weight)+"px"}})}var e=function(a){return a.weight},f=b.scale.linear().domain([0,b.max(a,e)]).range([0,120]),g=c.selectAll("tr").data(a),h=this.config;g.enter().append("tr"),g.append("td").style({width:"20px"}).append("input").attr({"class":"weightInput",type:"text",value:function(a){return a.weight},size:5}).on("input",function(b){a[b.index].weight=+this.value,d()}),g.append("td").append("div").attr("class","predictBar").style({width:function(a){return f(a.weight)+"px"},height:"20px","background-color":function(a){return h.colorMapping.get(a.dataID)}}),g.append("td").attr("class","datalabel").text(function(a){return a.d}),d()},a.prototype.reweightStackedColumnDialog=function(a){var b=this,c=e('re-weight column "'+a.label+'"',d),f=a.children.map(function(b,c){return{d:b.column.label,dataID:b.getDataID(),weight:+a.childrenWeights[c],index:c}});this.reweightStackedColumnWidget(f,c.table),c.onOK(function(){c.remove(),b.changeWeights(a,f.map(function(a){return a.weight}))})},a.prototype.openMappingEditor=function(d,e){function f(a,b){return 0===c(a).not(b).length&&0===c(b).not(a).length}var g=d.column,h=g.scale,i=this,j=h,k=function(a){j=a.clamp(!0)},l=b.select("body").append("div").attr({"class":"lu-popup"}).style({left:+window.innerWidth/2-100+"px",top:"100px",width:"420px",height:"450px"}).html('<div style="font-weight: bold"> change mapping: </div><div class="mappingArea"></div><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="reset"><i class="fa fa-undo"></i> revert</button><button class="ok"><i class="fa fa-check"></i> ok</button>'),m=function(a){return+g.getRawValue(a)},n=a.mappingEditor(h,g.scaleOri.domain(),this.storage.data,m,k);l.select(".mappingArea").call(n),l.select(".ok").on("click",function(){g.scale=j,e.classed("filtered",!f(j.range(),g.scaleOri.range())||!f(j.domain(),g.scaleOri.domain())),i.storage.resortData({}),i.updateAll(!0),l.remove()}),l.select(".cancel").on("click",function(){g.scale=h,e.classed("filtered",!f(h.range(),g.scaleOri.range())||!f(h.domain(),g.scaleOri.domain())),l.remove()}),l.select(".reset").on("click",function(){j=h=g.scale=g.scaleOri,e.classed("filtered",!1),n=a.mappingEditor(h,g.scaleOri.domain(),i.storage.data,m,k),l.selectAll(".mappingArea *").remove(),l.select(".mappingArea").call(n)})},a.prototype.stackedColumnOptionsGui=function(a){function c(a){g.storage.removeColumn(a),g.headerUpdateRequired=!0,g.updateAll()}function d(a){var c=+window.innerWidth/2-100,d=100,e=b.select("body").append("div").attr({"class":"lu-popup"}).style({left:c+"px",top:d+"px",width:"200px",height:"70px"}).html('<div style="font-weight: bold"> rename column: </div><input type="text" id="popupInputText" size="20" value="'+a.label+'"><br><button class="cancel"><i class="fa fa-times"></i> cancel</button><button class="ok"><i class="fa fa-check"></i> ok</button>');e.select(".ok").on("click",function(){var b=document.getElementById("popupInputText").value;b.length>0?(g.storage.setColumnLabel(a,b),g.updateHeader(g.storage.getColumnLayout()),e.remove()):window.alert("non empty string required")}),e.select(".cancel").on("click",function(){e.remove()})}var e=this.config,f=this.$header.select(".overlay"),g=this,h=this.stackedColumnModified===a;if(h)return f.selectAll(".stackedOption").remove(),void(this.stackedColumnModified=null);this.stackedColumnModified=a;var i=[{name:" remove",action:c},{name:" rename",action:d},{name:" re-weight",action:g.reweightStackedColumnDialog}],j=100*i.length,k=f.selectAll(".stackedOption").data([{d:a,o:i}]);k.exit().remove();var l=k.enter().append("g").attr({"class":"stackedOption",transform:function(a){return"translate("+(a.d.offsetX+a.d.columnWidth-j)+","+(e.htmlLayout.headerHeight/2-2)+")"}});l.append("rect").attr({x:0,y:0,width:j,height:e.htmlLayout.headerHeight/2-4}),l.selectAll("text").data(function(a){return a.o}).enter().append("text").attr({x:function(a,b){return 100*b+5},y:e.htmlLayout.headerHeight/4-2}).text(function(a){return a.name}),k.selectAll("text").on("click",function(b){f.selectAll(".stackedOption").remove(),b.action.call(g,a)}),k.transition().attr({transform:function(a){return"translate("+(a.d.offsetX+a.d.columnWidth-j)+","+(e.htmlLayout.headerHeight/2-2)+")"}})},a.prototype.openFilterPopup=function(d,e){function f(a){d.filter=a,e.classed("filtered",a&&a.length>0),j.storage.resortData({}),j.updateBody()}if(d instanceof a.LayoutSingleColumn&&d.column instanceof a.LineUpStringColumn){var g=c(this.$header.node()).offset();g.left+=d.offsetX,g.top+=d.offsetY;var h=d.filter||"",i=b.select("body").append("div").attr({"class":"lu-popup2"}).style({left:g.left+"px",top:g.top+"px"}).html('<form onsubmit="return false"><input type="text" id="popupInputText" placeholder="containing..." autofocus="true" size="18" value="'+h+'"><br><button class="ok"><i class="fa fa-check" title="ok"></i></button><button class="cancel"><i class="fa fa-times" title="cancel"></i></button><button class="reset"><i class="fa fa-undo" title="reset"></i></button></form>'),j=this;i.select(".cancel").on("click",function(){document.getElementById("popupInputText").value=h,f(h),i.remove()}),i.select(".reset").on("click",function(){document.getElementById("popupInputText").value="",f(null)}),i.select(".ok").on("click",function(){f(document.getElementById("popupInputText").value),i.remove()})}},a.createTooltip=function(a){function b(a,b){i.html(a).css({left:b.x+"px",top:b.y+b.height+"px"}).fadeIn();var d=c(window).height()+c(window).scrollTop()<=b.y+b.height+i.height()-20,e=c(window).scrollTop()>b.y-i.height();d&&!e&&i.css("top",b.y-i.height()+"px")}function d(){i.stop(!0).hide()}function e(a){a.x&&i.css({left:a.x+"px"}),a.y&&i.css({top:a.y+"px"})}function f(){return[i.width(),i.height()]}function g(){i.remove()}var h=c(a),i=c('<div class="lu-tooltip"/>').appendTo(h);return{show:b,hide:d,move:e,size:f,destroy:g}},a.prototype.initScrolling=function(a){function b(){var a=g.scrollTop,b=g.scrollLeft;f.scrolled(a,b),Math.abs(i-a)>=h*k&&(i=a,f.updateBody())}function d(b,c){var d,f=g.scrollTop-e,i=f+a.innerHeight(),j=0;if(f>0){for(j=Math.round(f/h);j>=0&&c(b[j+1])>f;)j--;j-=k}for(d=Math.round(i/h);d<=b.length&&c(b[d-1])<i;)d++;return d+=k,[Math.max(j,0),Math.min(d,b.length)]}var e,f=this,g=a[0],h=this.config.svgLayout.rowHeight,i=g.scrollTop,j=c(this.$table.node()),k=this.config.svgLayout.backupScrollRows;return a.on("scroll",b),e=j.offset().top-a.offset().top+this.config.htmlLayout.headerHeight,{selectVisible:d,onScroll:b}},a.prototype.initDragging=function(){function c(){b.event.sourceEvent.stopPropagation(),b.select(this).classed("dragging",!0)}function d(){var a=Math.max(b.mouse(this.parentNode)[0],2);f.reweightHeader({column:b.select(this).data()[0],value:a}),f.updateBody(f.storage.getColumnLayout(),f.storage.getData(),!1)}function e(){b.select(this).classed("dragging",!1),f.config.columnBundles.primary.sortedColumn instanceof a.LayoutStackedColumn&&(f.storage.resortData({column:f.config.columnBundles.primary.sortedColumn}),f.updateBody(f.storage.getColumnLayout(),f.storage.getData(),!1))}var f=this;return b.behavior.drag().origin(function(a){return a}).on("dragstart",c).on("drag",d).on("dragend",e)}}(d||(d={}),b,a);var d;!function(a,b){a.prototype=a.prototype||{},a.prototype.layoutHeaders=function(c){var d=0,e=this.config;c.forEach(function(a){a.offsetX=d,a.offsetY=2,a.height=e.htmlLayout.headerHeight-4,d+=a.getColumnWidth()});var f=d+4;b.values(e.svgLayout.plusSigns).forEach(function(a){a.x=f,f+=a.w+4}),c.filter(function(b){return b instanceof a.LayoutStackedColumn}).forEach(function(a){a.height=e.htmlLayout.headerHeight/2-4;var b=0,c=a.offsetX,d=a.children.concat(a.emptyColumns);d.map(function(a){a.offsetX=c+b,a.localOffsetX=b,b+=a.getColumnWidth(),a.offsetY=e.htmlLayout.headerHeight/2+2,a.height=e.htmlLayout.headerHeight/2-4})}),this.totalWidth=f},a.prototype.assignColors=function(c){var d=this.config;d.colorMapping=b.map();var e=0;c.forEach(function(b){b instanceof a.LineUpStringColumn||"rank"===b.id?d.colorMapping.set(b.id,d.grayColor):(d.colorMapping.set(b.id,d.columnColors(e)),e++)})}}(d||(d={}),b);var d;!function(a,b){function c(a,b,c,d,e,f){return a.append("line").attr({x1:b,y1:c,x2:d,y2:e,"class":f})}function d(a,b,c,d,e,f){return e=e||null,f=f||null,a.append("text").attr({x:b,y:c,dy:e,"class":f}).text(d)}function e(a,b,c,d,e){return c-=b,a.append("circle").attr({"class":"handle",r:e,cx:b,cy:d,transform:"translate("+c+",0)"})}a.mappingEditor=function(a,f,g,h,i){var j=function(j){function k(a,c){return b.behavior.drag().on("dragstart",function(){b.select(this).classed("dragging",!0).attr("r",1.1*q),a.style("visibility","visible")}).on("drag",c).on("dragend",function(){b.select(this).classed("dragging",!1).attr("r",q),a.style("visibility",null)}).origin(function(){var a=b.transform(b.select(this).attr("transform"));return{x:a.translate[0],y:a.translate[1]}})}function l(){a.range([y,z]),D.attr("x1",function(b){return a(h(b))}),n()}function m(){var b,c;B>A?(b=D.filter(function(a){return w(h(a))<A||w(h(a))>B}),c=D.filter(function(a){return!(w(h(a))<A||w(h(a))>B)})):(b=D.filter(function(a){return w(h(a))>A||w(h(a))<B}),c=D.filter(function(a){return!(w(h(a))>A||w(h(a))<B)})),b.style("visibility","hidden"),a.domain([w.invert(A),w.invert(B)]),c.style("visibility",null).attr("x1",function(b){return a(h(b))}),n()}function n(){var a=b.scale.linear().domain([w.invert(A),w.invert(B)]).range([x.invert(y),x.invert(z)]);i(a)}var o=400,p=400,q=10,r=j.append("svg").attr({"class":"lugui-me",width:o,height:p}),s=50,t=350,u=50,v=350,w=b.scale.linear().domain(f).range([s,t]),x=b.scale.linear().domain([0,1]).range([s,t]),y=x(a.range()[0]),z=x(a.range()[1]),A=w(a.domain()[0]),B=w(a.domain()[1]);a=b.scale.linear().clamp(!0).domain(a.domain()).range([y,z]);var C=r.append("g");c(C,s,u,t,u,"axis"),d(C,s,u-25,0,".75em"),d(C,t,u-25,1,".75em"),d(C,o/2,u-25,"Score",".75em","centered"),c(C,s,v,t,v,"axis"),d(C,s,v+20,f[0],".75em"),d(C,t,v+20,f[1],".75em"),d(C,o/2,v+20,"Raw",".75em","centered");var D=r.append("g").classed("data",!0).selectAll("line").data(g);D.enter().append("line").attr({x1:function(b){return a(h(b))},y1:u,x2:function(a){return w(h(a))},y2:v}).style("visibility",function(a){var b;return b=B>A?w(h(a))<A||w(h(a))>B:w(h(a))>A||w(h(a))<B,b?"hidden":null});var E=c(r,y,u,A,v,"bound"),F=c(r,z,u,B,v,"bound"),G=d(r,s+5,u-15,b.round(x.invert(y),2),".25em","drag").attr("transform","translate("+(y-s)+",0)"),H=d(r,s+5,v-15,b.round(w.invert(A),2),".25em","drag").attr("transform","translate("+(A-s)+",0)"),I=d(r,t+5,u-15,b.round(x.invert(z),2),".25em","drag").attr("transform","translate("+(z-t)+",0)"),J=d(r,t+5,v-15,b.round(w.invert(B),2),".25em","drag").attr("transform","translate("+(B-t)+",0)");e(r,s,y,u,q).call(k(G,function(){b.event.x>=0&&b.event.x<=t-s&&(E.attr("x1",s+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),y=b.event.x+s,G.text(b.round(x.invert(y),2)).attr("transform","translate("+b.event.x+", 0)"),l())})),e(r,t,z,u,q).call(k(I,function(){b.event.x>=-1*(t-s)&&b.event.x<=0&&(F.attr("x1",t+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),z=b.event.x+t,I.text(b.round(x.invert(z),2)).attr("transform","translate("+b.event.x+", 0)"),l())})),e(r,s,A,v,q).call(k(H,function(){b.event.x>=0&&b.event.x<=t-s&&(E.attr("x2",s+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),A=b.event.x+s,H.text(b.round(w.invert(A),2)).attr("transform","translate("+b.event.x+", 0)"),m())})),e(r,t,B,v,q).call(k(J,function(){b.event.x>=-1*(t-s)&&b.event.x<=0&&(F.attr("x2",t+b.event.x),b.select(this).attr("transform","translate("+b.event.x+", 0)"),B=b.event.x+t,J.text(b.round(w.invert(B),2)).attr("transform","translate("+b.event.x+", 0)"),m())}))};return j}}(d||(d={}),b);var d;!function(a,b,c,d,e){function f(b,d,e,g,h){function i(a){return new k[a.type](a,i)}function j(a){var b=a.type||"single";return new l[b](a,m.rawcols,j,m)}this.storageConfig=c.extend(!0,{},{colTypes:{number:a.LineUpNumberColumn,string:a.LineUpStringColumn,rank:a.LineUpRankColumn},layoutColumnTypes:{single:a.LayoutSingleColumn,stacked:a.LayoutStackedColumn,rank:a.LayoutRankColumn,actions:a.LayoutActionColumn}},h),this.config=null;var k=this.storageConfig.colTypes,l=this.storageConfig.layoutColumnTypes,m=this;this.storageConfig.toColumn=i,this.storageConfig.toLayoutColumn=j,this.primaryKey=g,this.rawdata=b,this.data=b,this.rawcols=d.map(i),this.layout=e||f.generateDefaultLayout(this.rawcols),this.bundles={primary:{layoutColumns:[],needsLayout:!0}}}a.LineUpLocalStorage=f,a.createLocalStorage=function(a,b,c,d,e){return new f(a,b,c,d,e)},f.generateDefaultLayout=function(b){var c=b.map(function(b){return{column:b.id,width:b instanceof a.LineUpStringColumn?200:100}});return{primary:c}},f.prototype=c.extend({},{},{getRawColumns:function(){return this.rawcols},getColumnLayout:function(a){var b=a||"primary";return this.bundles[b].needsLayout&&(this.generateLayout(this.layout,b),this.bundles[b].needsLayout=!1),this.bundles[b].layoutColumns},getData:function(){return this.data},filterData:function(a){a=a||this.bundles.primary.layoutColumns;var b=[];a.forEach(function(a){a.flattenMe(b)}),b=b.filter(function(a){return a.isFiltered()}),c.isFunction(this.config.filter.filter)&&b.push(this.config.filter.filter),this.data=0===b.length?this.rawdata:this.rawdata.filter(function(a){return b.every(function(b){return b.filterBy(a)})})},resortData:function(b){var c=b.key||"primary",d=this.bundles[c],e=b.asc||this.config.columnBundles.primary.sortingOrderAsc,f=b.column||this.config.columnBundles.primary.sortedColumn;this.filterData(d.layoutColumns),f&&(this.data.sort(f.sortBy),e&&this.data.reverse());var g=this.config.filter.skip?this.config.filter.skip:0;this.data=this.config.filter.limit&&isFinite(this.config.filter.limit)?this.data.slice(g,g+this.config.filter.limit):this.data.slice(g);var h=d.layoutColumns.filter(function(b){return b.column instanceof a.LineUpRankColumn});if(h.length>0){var i=function(a,b){return b};f instanceof a.LayoutStackedColumn?i=function(a){return f.getValue(a)}:f&&(i=function(a){return f.column.getValue(a)}),this.assignRanks(this.data,i,h[0].column)}},assignRanks:function(a,b,c){var d=1,e=-1;a.forEach(function(a,f){-1===e&&(e=b(a,f)),e!==b(a,f)&&(d=f+1,e=b(a,f)),c.setValue(a,d)})},generateLayout:function(b,c){var d=c||"primary",e={};e.layoutColumns=b[d].map(this.storageConfig.toLayoutColumn),e.layoutColumns.filter(function(b){return b instanceof a.LayoutRankColumn}).length<1&&e.layoutColumns.unshift(new a.LayoutRankColumn(null,null,null,this)),this.config.svgLayout.rowActions.length>0&&e.layoutColumns.filter(function(b){return b instanceof a.LayoutActionColumn}).length<1&&e.layoutColumns.push(new a.LayoutActionColumn),this.bundles[d]=e},addColumn:function(b,c){var d,e,f=c||"primary",g=this.bundles[f].layoutColumns;for(d=0;d<g.length&&(e=g[d],e instanceof a.LayoutRankColumn||e instanceof a.LayoutSingleColumn&&e.column instanceof a.LineUpStringColumn);++d);g.splice(d,0,b)},addStackedColumn:function(b,c){var d=b||{label:"Stacked",children:[]};this.addColumn(new a.LayoutStackedColumn(d,this.rawcols,this.storageConfig.toLayoutColumn),c)},addSingleColumn:function(b,c){this.addColumn(new a.LayoutSingleColumn(b,this.rawcols),c)},removeColumn:function(b,c){var f=c||"primary",g=this.bundles[f].layoutColumns;if(b instanceof a.LayoutStackedColumn){var h=d.indexOf(g,b);if(h!==e){var i=[];Array.prototype.splice.apply(g,[h,1].concat(i))}}else b instanceof a.LayoutSingleColumn&&(null===b.parent||b.parent===e?g.splice(g.indexOf(b),1):(b.parent.removeChild(b),this.resortData({})))},setColumnLabel:function(a,b,c){var d=c||"primary",e=this.bundles[d].layoutColumns;
e.filter(function(b){return b.id===a.id})[0].label=b},moveColumn:function(a,b,c,d){var e,f=d||"primary",g=this.bundles[f].layoutColumns;null==a.parent&&null==b.parent?(g.splice(g.indexOf(a),1),e=g.indexOf(b),"r"===c&&e++,g.splice(e,0,a)):null!==a.parent&&null===b.parent?(a.parent.removeChild(a),e=g.indexOf(b),"r"===c&&e++,g.splice(e,0,a)):null===a.parent&&null!==b.parent?b.parent.addChild(a,b,c)&&g.splice(g.indexOf(a),1):null!==a.parent&&null!==b.parent&&(a.parent.removeChild(a),b.parent.addChild(a,b,c)),this.resortData({})},copyColumn:function(a,b,c,d){var e=d||"primary",f=this.bundles[e].layoutColumns,g=a.makeCopy();if(null==b.parent){var h=f.indexOf(b);"r"===c&&h++,f.splice(h,0,g)}else null!==b.parent&&b.parent.addChild(g,b,c);this.resortData({})},getColumnByName:function(a){for(var b=this.getColumnLayout(),c=b.length-1;c>=0;--c){var d=b[c];if(d.getLabel()===a||d.column&&d.column.column===a)return d}return null}})}(d||(d={}),b,a,c);var d;!function(a,b,c){function d(b,c,d,e){var f=b.filter(function(b){return b.column instanceof a.LineUpStringColumn||b instanceof a.LayoutRankColumn}),g=e.svgLayout.rowHeight/2,h=c.selectAll(".tableData.text").data(function(b){var c=f.map(function(c){return{value:c.column.getValue(b),label:c.column.getRawValue(b),offsetX:c.offsetX,columnW:c.getColumnWidth(),isRank:c instanceof a.LayoutRankColumn,clip:"url(#clip-B"+c.id+")"}});return c});h.enter().append("text").attr({"class":function(a){return"tableData text"+(a.isRank?" rank":"")},y:g,"clip-path":function(a){return a.clip}}),h.exit().remove(),h.attr("x",function(a){return a.offsetX}).text(function(a){return a.label}),c.selectAll(".tableData.text.rank").text(function(a){return a.label})}function e(b){if(!b.renderingOptions.stacked||b.renderingOptions.values)return!1;var c=b.columnBundles.primary.sortedColumn;return!(c&&c.parent instanceof a.LayoutStackedColumn)}function f(b,c,d){var e=b.filter(function(b){return b.column instanceof a.LineUpNumberColumn}),f=c.selectAll(".tableData.bar").data(function(a){var b=e.map(function(b){return{key:b.getDataID(),value:b.getWidth(a),label:b.column.getRawValue(a),offsetX:b.offsetX}});return b});f.enter().append("rect").attr({"class":"tableData bar",y:2,height:d.svgLayout.rowHeight-4}),f.exit().remove(),f.attr({x:function(a){return a.offsetX},width:function(a){return Math.max(+a.value-2,0)}}).style({fill:function(a){return d.colorMapping.get(a.key)}})}function g(b,c,d,f){var g=b.filter(function(b){return b instanceof a.LayoutStackedColumn}),h=c.selectAll(".tableData.stacked").data(function(a){var b=g.map(function(b){return{key:b.getDataID(),childs:b.children,parent:b,row:a}});return b});h.exit().remove(),h.enter().append("g").attr("class","tableData stacked"),h.attr("transform",function(a){return"translate("+a.parent.offsetX+",0)"});var i=0,j=0,k={},l=e(f),m=h.selectAll("rect").data(function(a){return i=0,j=0,a.childs.map(function(b){return j=b.getWidth(a.row),k={child:b,width:j,offsetX:i},i+=l?j:b.getColumnWidth(),k})});m.exit().remove(),m.enter().append("rect").attr({y:2,height:f.svgLayout.rowHeight-4}),(d?m.transition(f.svgLayout.animationDuration):m).attr({x:function(a){return a.offsetX},width:function(a){return a.width>2?a.width-2:a.width}}).style({fill:function(a){return f.colorMapping.get(a.child.getDataID())}})}function h(a,b,c){var d=a.selectAll("text").data(c.svgLayout.rowActions);d.enter().append("text").append("title"),d.exit().remove(),d.attr("x",function(a,b){return b*c.svgLayout.rowHeight}).text(function(a){return a.icon}).on("click",function(a){a.action.call(this,b.data,a)}).select("title").text(function(a){return a.name})}function i(c,d,e){var f=c.filter(function(b){return b instanceof a.LayoutActionColumn}),g=d.selectAll(".tableData.action").data(function(a){var b=f.map(function(b){return{key:b.getDataID(),value:b.getColumnWidth(a),data:a,offsetX:b.offsetX}});return b});g.enter().append("g").attr("class","tableData action").each(function(a){h(b.select(this),a,e)}),g.exit().remove(),g.attr("transform",function(a){return"translate("+(a.offsetX+10)+","+(.5*e.svgLayout.rowHeight+1)+")"})}function j(b,c){if(b instanceof a.LayoutStackedColumn)return b.getValue(c);if(b instanceof a.LayoutSingleColumn&&b.column instanceof a.LineUpNumberColumn){var d=b.column.getRawValue(c);return isNaN(d)||""===d.toString()?"":+d}return b.column?b.column.getValue(c):""}function k(a,b,d){var e=c("<div><table><thead><tr><th>Column</th><th>Value</th></tr></thead><tbody></tbody></table></div>"),f=e.find("tbody");return b.forEach(function(b){var e=j(b,a);"undefined"==typeof e?e="":"number"==typeof e&&(e=d.numberformat(e)),c("<tr><th>"+b.getLabel()+"</th><td>"+e+"</td></tr>").appendTo(f)}),e.html()}a.prototype=a.prototype||{},a.updateClipPaths=function(a,b,c,d,e){e=e||"column";var f=b.select("defs."+e).selectAll(function(){return this.getElementsByTagName("clipPath")}).data(a,function(a){return a.id});f.enter().append("clipPath").attr("id",function(a){return"clip-"+c+a.id}).append("rect").attr({y:0,height:"1000"}),f.exit().remove(),f.select("rect").attr({x:function(a){return d?a.offsetX:null},width:function(a){return Math.max(a.getColumnWidth()-5,0)}})},a.prototype.updateBody=function(c,h,j){function l(b){function d(a){return isNaN(a)||""===a||"undefined"==typeof a?"":o.config.numberformat(+a)}var e=[];return c.forEach(function(c){if(c.column instanceof a.LineUpNumberColumn)e.push({id:c.id,value:c.column.getValue(b),label:o.config.numberformat(+c.column.getRawValue(b)),x:c.offsetX,w:c.getColumnWidth()});else if(c instanceof a.LayoutStackedColumn){var f=0;c.children.forEach(function(a){var g=a.getWidth(b);e.push({id:a.id,label:d(a.column.getRawValue(b))+" -> ("+q(a.getWidth(b))+")",w:y?g:a.getColumnWidth(),x:f+c.offsetX}),f+=y?g:a.getColumnWidth()})}}),e}function m(a,b,c,d){a.selectAll("text."+c).data(b).enter().append("text").attr({"class":"tableData "+c,x:function(a){return a.x},y:o.config.svgLayout.rowHeight/2,"clip-path":function(a){return"url(#clip-"+d+a.id+")"}}).text(function(a){return a.label})}c=c||this.storage.getColumnLayout(),h=h||this.storage.getData(),j=j||!1;var n=this.$body,o=this,p=this.storage.primaryKey,q=b.format(".1f");j=j||!1;var r=[];c.forEach(function(a){a.flattenMe(r)});var s=h.length,t=b.scale.ordinal().domain(h.map(function(a){return a[p]})).rangeBands([0,s*o.config.svgLayout.rowHeight],0,.2),u=this.prevRowScale||t;this.prevRowScale=t,this.$table.attr("height",s*o.config.svgLayout.rowHeight+o.config.htmlLayout.headerHeight);var v=this.selectVisible(h,t);(v[0]>0||v[1]<h.length)&&(h=h.slice(v[0],v[1]));var w=n.selectAll(".row").data(h,function(a){return a[p]});w.exit().remove();var x=w.enter().append("g").attr({"class":"row",transform:function(a){var b=u(a[p]);return"undefined"==typeof b&&(b=t.range()[1]),"translate(0,"+b+")"}});x.append("rect").attr({"class":"filler",width:"100%",height:o.config.svgLayout.rowHeight}),(this.config.renderingOptions.animation?w.transition().duration(this.config.svgLayout.animationDuration):w).attr({transform:function(a){return"translate(0,"+t(a[p])+")"}});var y=e(this.config);w.on({mouseenter:function(a){function c(a){var b=document.documentElement.scrollTop||document.body.scrollTop,c=a.getScreenCTM(),d=a.getBBox(),e=o.$table.node().createSVGPoint();return e.x=d.x,e.y=d.y,e=e.matrixTransform(c),b+e.y}var d=b.select(this);d.classed("hover",!0);var e=l(a),f=t(a[p]),g=o.$table.select("defs.overlay").selectAll(function(){return this.getElementsByTagName("clipPath")}).data(e);g.enter().append("clipPath").append("rect").attr({height:"1000"}),g.exit().remove(),g.attr("y",f).attr("id",function(a){return"clip-M"+a.id}),g.select("rect").attr({x:function(a){return a.x},width:function(a){return Math.max(a.w-2,0)}}),m(d,e,"hoveronly","M"),o.tooltip.show(k(a,r,o.config),{x:b.event.x+10,y:c(this),height:o.config.svgLayout.rowHeight})},mousemove:function(){o.tooltip.move({x:b.event.x})},mouseleave:function(){o.tooltip.hide(),b.select(this).classed("hover",!1),b.select(this).selectAll("text.hoveronly").remove()}});var z=w;f(c,z,o.config),g(c,z,this.config.renderingOptions.animation&&j,o.config),i(c,z,o.config),a.updateClipPaths(r,this.$table,"B",!0),d(r,z,n,o.config),o.config.renderingOptions.values?(w.classed("values",!0),w.each(function(a){var c=b.select(this);m(c,l(a),"valueonly","B")})):w.classed("values",!1).selectAll("text.valueonly").remove()}}(d||(d={}),b,a);var d;return function(a,b,c){a.prototype=a.prototype||{},a.prototype.updateHeader=function(d){d=d||this.storage.getColumnLayout();var e=this.$header,f=e.select("g.main"),g=this,h=this.config;this.headerUpdateRequired&&(this.layoutHeaders(d),this.$table.attr("width",this.totalWidth),this.headerUpdateRequired=!1);var i=[];d.forEach(function(a){a.flattenMe(i,{addEmptyColumns:!0})}),i.reverse(),a.updateClipPaths(i,this.$table,"H",!1,"columnheader");var j=f.selectAll(".header").data(i,function(a){return a.id});j.exit().remove();var k=j.enter().append("g").attr("class","header").classed("emptyHeader",function(b){return b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn}).call(function(){g.addResortDragging(this,h)});if(j.attr("transform",function(a){return"translate("+a.offsetX+","+a.offsetY+")"}),k.append("rect").attr({"class":"labelBG",y:0}).style("fill",function(b){return b instanceof a.LayoutEmptyColumn?"lightgray":b instanceof a.LayoutStackedColumn||!h.colorMapping.has(b.column.id)||b instanceof a.LayoutActionColumn?h.grayColor:h.colorMapping.get(b.column.id)}).on("click",function(c){if(!(b.event.defaultPrevented||c instanceof a.LayoutEmptyColumn||c instanceof a.LayoutActionColumn||c instanceof a.LayoutStackedColumn&&c.children.length<1)){var d=h.columnBundles[c.columnBundle];d.sortingOrderAsc=null!==d.sortedColumn&&c.getDataID()===d.sortedColumn.getDataID()?!d.sortingOrderAsc:!1,g.storage.resortData({column:c,asc:d.sortingOrderAsc}),d.sortedColumn=c,g.updateAll(!1)}}),j.select(".labelBG").attr({width:function(a){return a.getColumnWidth()-5},height:function(a){return a.height}}),this.config.manipulative&&(k.filter(function(b){return!(b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn)}).append("rect").attr({"class":"weightHandle",x:function(a){return a.getColumnWidth()-5},y:0,width:5}),j.select(".weightHandle").attr({x:function(a){return a.getColumnWidth()-5},height:function(a){return a.height}}).call(this.dragWeight)),k.append("text").attr({"class":"headerLabel",x:12}),k.append("title"),j.select(".headerLabel").classed("sortedColumn",function(a){var b=h.columnBundles[a.columnBundle].sortedColumn;return b?a.getDataID()===b.getDataID():!1}).attr({y:function(b){return b instanceof a.LayoutStackedColumn||null!=b.parent?b.height/2:3*b.height/4},"clip-path":function(a){return"url(#clip-H"+a.id+")"}}).text(function(b){return b instanceof a.LayoutStackedColumn||b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn?b.label:b.column.label}),j.select("title").text(function(b){return b instanceof a.LayoutStackedColumn||b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn?b.label:b.column.label}),k.append("text").attr({"class":"headerSort",y:function(a){return a.height/2},x:2}),j.select(".headerSort").text(function(a){var b=h.columnBundles[a.columnBundle].sortedColumn;return b&&a.getDataID()===b.getDataID()?h.columnBundles[a.columnBundle].sortingOrderAsc?"":"":""}).attr({y:function(a){return a.height/2}}),this.config.manipulative){var l=[{"class":"stackedColumnInfo",text:"",filter:function(b){return b instanceof a.LayoutStackedColumn?[b]:[]},action:function(a){g.stackedColumnOptionsGui(a)},shift:15},{"class":"singleColumnDelete",text:"",filter:function(b){return b instanceof a.LayoutStackedColumn||b instanceof a.LayoutEmptyColumn||b instanceof a.LayoutActionColumn?[]:[b]},action:function(a){g.storage.removeColumn(a),g.headerUpdateRequired=!0,g.updateAll()},shift:15},{"class":"singleColumnFilter",text:"",filter:function(b){return b instanceof a.LayoutSingleColumn&&(b.column instanceof a.LineUpNumberColumn||b.column instanceof a.LineUpStringColumn)?[b]:[]},action:function(c){c.column instanceof a.LineUpStringColumn?g.openFilterPopup(c,b.select(this)):g.openMappingEditor(c,b.select(this))},shift:28}];l.forEach(function(a){var b=j.selectAll("."+a.class).data(a.filter);b.exit().remove(),b.enter().append("text").attr("class","fontawe "+a.class).text(a.text).on("click",a.action),b.attr({x:function(b){return b.getColumnWidth()-a.shift},y:10})})}var m=b.values(h.svgLayout.plusSigns),n=f.selectAll(".addColumnButton").data(m);n.exit().remove();var o=n.enter().append("g").attr({"class":"addColumnButton"});n.attr({transform:function(a){return"translate("+a.x+","+a.y+")"}}),o.append("rect").attr({x:0,y:0,rx:5,ry:5,width:function(a){return a.w},height:function(a){return a.h}}).on("click",function(a){c.isFunction(a.action)?a.action.call(g,a):g[a.action](a)}),o.append("text").attr({x:function(a){return a.w/2},y:function(a){return a.h/2}}).text("")},a.prototype.addResortDragging=function(c){function d(c){c instanceof a.LayoutEmptyColumn||(b.event.sourceEvent.stopPropagation(),b.select(this).classed("dragObject",!0),k=null,l=!1)}function e(c){function d(a,b,c){return b>a.offsetX&&b-a.offsetX<a.getColumnWidth()&&c>a.offsetY&&c-a.offsetY<a.height?b-a.offsetX<a.getColumnWidth()/2?{column:a,insert:"l",tickX:a.offsetX,tickY:a.offsetY,tickH:a.height}:{column:a,insert:"r",tickX:a.offsetX+a.getColumnWidth(),tickY:a.offsetY,tickH:a.height}:null}if(!(c instanceof a.LayoutEmptyColumn)){l=!0;var e=j.selectAll(".dragHeader").data([c]),f=e.enter().append("g").attr({"class":"dragHeader"});f.append("rect").attr({"class":"labelBG",width:function(a){return a.getColumnWidth()},height:function(a){return a.height}});var g=b.event.x,i=b.event.y;e.attr("transform",function(){return"translate("+(b.event.x+3)+","+(b.event.y-10)+")"});var m=[];h.storage.getColumnLayout().forEach(function(a){a.flattenMe(m,{addEmptyColumns:!0})});var n=0;for(k=null;n<m.length&&null==k;)k=d(m[n],g,i),n++;var o=j.selectAll(".columnTick").data(k?[k]:[]);o.exit().remove(),o.enter().append("rect").attr({"class":"columnTick",width:10}),o.attr({x:function(a){return a.tickX-5},y:function(a){return a.tickY},height:function(a){return a.tickH}})}}function f(c){b.event.defaultPrevented||c instanceof a.LayoutEmptyColumn||(b.select(this).classed("dragObject",!1),j.selectAll(".dragHeader").remove(),j.selectAll(".columnTick").remove(),k&&k.column===this.__data__||(k&&(b.event.sourceEvent.altKey?h.storage.copyColumn(this.__data__,k.column,k.insert):h.storage.moveColumn(this.__data__,k.column,k.insert),h.headerUpdateRequired=!0,h.updateAll()),null==k&&l&&(h.headerUpdateRequired=!0,h.storage.removeColumn(this.__data__),h.updateAll())))}if(this.config.manipulative){var g=b.behavior.drag(),h=this,i=this.$header,j=i.select("g.overlay"),k=null,l=!1;g.call(c),g.on("dragstart",d).on("drag",e).on("dragend",f)}},a.prototype.addNewEmptyStackedColumn=function(){this.storage.addStackedColumn(),this.headerUpdateRequired=!0,this.updateHeader()},a.prototype.reweightHeader=function(a){a.column.setColumnWidth(a.value),this.headerUpdateRequired=!0,this.updateHeader()}}(d||(d={}),b,a),d}"function"==typeof define&&define.amd?define(["jquery","d3","underscore"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery"),require("d3"),require("underscore")):this.LineUp=a(jQuery,d3,_)}).call(this);